# Phase 4 Graph Configuration
# Minimal multimodal knowledge graph: image, caption
# Used for graph-based retrieval with semantic and co-occurrence edges

# Dataset paths (Flickr30k)
dataset:
  data_root: "/kaggle/input/flickr30k/data"
  images_dir: "/kaggle/input/flickr30k/data/images"
  captions_csv: "/kaggle/input/flickr30k/data/results.csv"

# CLIP embedding configuration
clip:
  dim: 512  # Vector dimension for CLIP embeddings

# Graph construction parameters
graph:
  # Number of semantic neighbors (k-NN) for within-type edges
  # Creates image↔image and caption↔caption semantic edges
  k_sem: 16
  
  # Maximum degree (edges) per node
  degree_cap: 16
  
  # Edge weight data type for memory efficiency
  # Options: "fp16", "fp32"
  edge_dtype: "fp16"

# Beam search retrieval parameters
retriever:
  # Initial seed size (top-k from CLIP retrieval)
  K_seed: 10
  
  # Beam size (number of nodes to expand per iteration)
  B: 20
  
  # Maximum number of hops in graph traversal
  H: 2
  
  # Score decay factor per hop (geometric decay)
  decay: 0.85
  
  # Maximum total nodes to collect during search
  N_max: 200
  
  # Time cap in milliseconds (stops search if exceeded)
  T_cap_ms: 150
  
  # Marginal gain threshold (stops if gain < eps_gain)
  eps_gain: 0.001

# Score fusion configuration
fusion:
  # Default fusion strategy
  # Options: "rank_fusion", "weighted", "replace"
  default: "rank_fusion"
  
  # Weights for weighted fusion
  weighted_w:
    # CLIP bi-encoder weight
    w1: 0.7
    
    # Stage-2 cross-encoder weight (when strong agreement)
    w2: 0.2
    
    # Knowledge graph weight
    w3: 0.1

# Query enrichment configuration
enrichment:
  # Enable query expansion/enrichment
  enabled: true
  
  # Number of top terms to use for enrichment
  top_terms: 5

# Runtime configuration
runtime:
  # Fast random seed for reproducibility
  FAST_SEED: 12345
